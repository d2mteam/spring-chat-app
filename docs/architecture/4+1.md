# 4+1 Architecture Views

This document captures the 4+1 architectural views for the Spring Chat application. Each view is aligned to key packages and runtime behavior in the codebase.

## 1. Logical view

Represents the core domain model and how entities relate to each other.

```mermaid
classDiagram
    class ChatRoom {
      +Long id
      +String name
    }
    class Message {
      +Long id
      +String content
      +String senderId
      +Instant createdAt
    }
    class RoomMember {
      +Long id
      +String userId
      +Instant joinedAt
    }
    class MessageReceipt {
      +Long id
      +String userId
      +Instant readAt
    }

    ChatRoom "1" --> "*" Message : contains
    ChatRoom "1" --> "*" RoomMember : has
    Message "1" --> "*" MessageReceipt : read receipts
```

## 2. Development view

Shows the main modules and their dependencies within the repository.

```mermaid
flowchart LR
    subgraph Frontend
        FE[React UI]
    end

    subgraph Backend
        API[REST Controller]
        WS[WebSocket Handler]
        SVC[Chat Services]
        DOM[Domain Models]
        REPO[Repositories]
        INFRA[Infrastructure]
    end

    subgraph External
        PG[(PostgreSQL)]
        REDIS[(Redis Pub/Sub)]
    end

    FE --> API
    FE --> WS
    API --> SVC
    WS --> SVC
    SVC --> DOM
    SVC --> REPO
    REPO --> PG
    SVC --> INFRA
    INFRA --> REDIS
```

## 3. Process view

Highlights runtime interactions for common flows, focusing on concurrency and messaging.

```mermaid
sequenceDiagram
    participant Client
    participant WS as WebSocket Handler
    participant Router as Message Router
    participant Service as Message Service
    participant Redis as Redis Pub/Sub

    Client->>WS: Send message
    WS->>Router: Parse & route payload
    Router->>Service: saveAndPublish()
    Service->>Redis: Publish chat event
    Redis-->>WS: Fan-out to subscribers
    WS-->>Client: Deliver message
```

## 4. Physical view

Deployment topology for local or containerized environments.

```mermaid
flowchart TB
    Client[Browser / Mobile Client]
    App[Spring Boot Service]
    Redis[(Redis)]
    DB[(PostgreSQL)]

    Client -->|HTTP / WebSocket| App
    App --> Redis
    App --> DB
```

## 5. Scenarios (+1)

A representative use case: marking a message as read.

```mermaid
sequenceDiagram
    participant Client
    participant WS as WebSocket Handler
    participant Service as Message Service
    participant Repo as MessageReceiptRepository
    participant Redis as Redis Receipt Pub/Sub

    Client->>WS: MarkRead request
    WS->>Service: markRead()
    Service->>Repo: save receipt
    Service->>Redis: Publish receipt event
    Redis-->>WS: Notify subscribers
    WS-->>Client: Receipt delivered
```
